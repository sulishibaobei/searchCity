<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>选择城市</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/chooseCity.css">
    <script>
        //自适应屏幕大小 
        (function() {
            var docEle = document.documentElement,
                evt = "onorientationchange" in window ? "orientationchange" : "",
                fn = function() {
                    var width = docEle.clientWidth;
                    width && (docEle.style.fontSize = width / 7.5 + "px");
                };
            fn();
            if (window.addEventListener) {
                if (evt) {
                    window.addEventListener(evt, fn, false);
                }
                window.addEventListener("resize", fn, false);
                document.addEventListener("DOMContentLoaded", fn, false);
            }
        })();
    </script>

</head>

<body>
    <header class="head-fixed" style="background: #FFFFFF;">
        <div class="city-search-wrap">
            <div id="city-search">
                <i class="sprite-search icon-search"></i>
                <input type="text" class="ser-txt" placeholder="请输入城市名" id="searchContext" maxlength="50">
            </div>
        </div>
    </header>
    <section class="choose-city-wrap">
        <div class="box">
            <div class="city-list-title">当前城市</div>
            <div class="city-list clear">
                <span class="nowCity chooseCity">深圳</span>
                <span class="nowCity" style="display:none">定位失败<img src="images/circle@2x.png" class='seekFailed'  /></span>
            </div>
        </div>
        <div class="box">
            <div class="city-list-title" id="A">A</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="鞍山">鞍山<i></i></span>
                <span class="nowCity" data-name="安阳">安阳<i></i></span>
                <span class="nowCity" data-name="安庆">安庆</span>
            </div>
        </div>
        <div class="box">
            <div class="city-list-title" id="B">B</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="北京">北京<i></i></span>
                <span class="nowCity" data-name="北海">北海<i></i></span>
                <span class="nowCity" data-name="宝鸡">宝鸡<i></i></span>
                <span class="nowCity" data-name="本溪">本溪</span>
            </div>
        </div>
        <div class="box">
            <div class="city-list-title" id="C">C</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="长沙">长沙<i></i></span>
                <span class="nowCity" data-name="潮州">潮州<i></i></span>
                <span class="nowCity" data-name="成都">成都<i></i></span>
                <span class="nowCity" data-name="长春">长春</span>
            </div>
        </div>
        <div class="box">
            <div class="city-list-title" id="D">D</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="东莞">东莞<i></i></span>
                <span class="nowCity" data-name="大连">大连<i></i></span>
                <span class="nowCity" data-name="达州">达州</span>
            </div>
        </div>
        <div class="box">
            <div class="city-list-title" id="F">F</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="佛山">佛山<i></i></span>
                <span class="nowCity" data-name="抚顺">抚顺<i></i></span>
                <span class="nowCity" data-name="福州">福州</span>
            </div>
        </div>
        <div class="box">
            <div class="city-list-title" id="G">G</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="广州">广州<i></i></span>
                <span class="nowCity" data-name="贵阳">贵阳<i></i></span>
                <span class="nowCity" data-name="赣州">赣州<i></i></span>
                <span class="nowCity" data-name="贵港">贵港<i></i></span>
                <span class="nowCity" data-name="桂林">桂林</span>
            </div>
        </div>
        <div class="box">
            <div class="city-list-title" id="H">H</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="惠州">惠州<i></i></span>
                <span class="nowCity" data-name="杭州">杭州<i></i></span>
                <span class="nowCity" data-name="呼和浩特">呼和浩特<i></i></span>
                <span class="nowCity" data-name="海口">海口</span>
            </div>
        </div>

        <div class="box">
            <div class="city-list-title" id="J">J</div>
            <div class="city-list clear">
                <span class="nowCity" data-name="江门">江门<i></i></span>
                <span class="nowCity" data-name="揭阳">揭阳<i></i></span>
                <span class="nowCity" data-name="九江">九江</span>
            </div>
        </div>
        <div class="choose-city-chart">
            <a href="javascript:void(0);">#</a>
            <a href="javascript:void(0);" data-key="A" class="curr">A</a>
            <a href="javascript:void(0);" data-key="B">B</a>
            <a href="javascript:void(0);" data-key="C">C</a>
            <a href="javascript:void(0);" data-key="D">D</a>
            <a href="javascript:void(0);" data-key="F">F</a>
            <a href="javascript:void(0);" data-key="G">G</a>
            <a href="javascript:void(0);" data-key="H">H</a>
            <a href="javascript:void(0);" data-key="J">J</a>
        </div>
    </section>
    <div class="city-search-list">
        <div class="mask"></div>
        <div class="search-list" id="searchList">
            <!-- <a name="city" data-code="null" data-name="惠州">惠州</a> -->
        </div>
    </div>
    <input style="display:none" id="valC"  /> 
</body>
<script src="jquery.js"></script>
<script src='fastclick.js'></script>
<script src="pinyin.js"></script>
<script>
/**
* 一般来说，录数据库的会输入助力码  例如 惠州 hz
*/
    var city=[];
    $("#searchContext").on("focus", function() {
        $(".city-search-list").show();
        $(".city-search-list .mask").show();
        $("body").css('overflow', 'hidden');
        $(".city-search-list .search-list").hide();
    }).on("input propertychange", function() {
        var val = $.trim($(this).val());
        if (val == "") {
            $(".city-search-list .mask").show();
            $("body").css('overflow', 'hidden');
            $(".city-search-list .search-list").hide();
            return;
        }
        //1.如果输入的是拼音  匹配首字母   2.输入的字，匹配所有含有字的
          val = val.toUpperCase();
         $("#searchList").html("");
        if (val.length == 1) {
            var id = $(".city-list-title[id=" + val + "]");
            if (id.length == 0) {
                $("#searchList").html('<span  style="font-size:0.28rem;margin-top:10px;display:block">暂无匹配结果</span>');
            } else if (id.length == 1) {
                city=[];
                var obj=id.next().find('span');
                for(var i=0;i<obj.length;i++){
                     $("#searchList").append(' <a name="city" data-code="null" data-name='+obj.eq(i).attr('data-name')+'>'+obj.eq(i).attr('data-name')+'</a>');
                     city.push(obj.eq(i).attr('data-name'));
                }    
            }
        }else if(val.length>=2){
            for(var i=0;i<city.length;i++){
                if(getPinYinFirstCharacter(city[i],"",true).indexOf(val)>-1){
                  $("#searchList").append(' <a name="city" data-code="null" data-name='+city[i]+'>'+city[i]+'</a>');
                }
            }
        }else{
            $("#searchList").html('<span  style="font-size:0.28rem;margin-top:10px;display:block">暂无匹配结果</span>');
        }
       $(".city-search-list .search-list").show();
    })
     
    $("#searchList").on('click','a',function(){
        $(".chooseCity").html($(this).html());
        $(".city-search-list .search-list").hide();
         $(".city-search-list .mask").hide();
         $("body").css('overflow', 'unset');
    })

    $(".city-search-list .mask").on("click", function() {
        $(".city-search-list").hide();
        $("body").css('overflow-y', 'auto');
    });
  

    // 字母定位
    $(".choose-city-chart").on("click", "a", function() {
        var key = $(this).data("key");
        $("body,html").animate({
            "scrollTop": $("#" + key).offset().top - $(".head-fixed").outerHeight() - 10
        }, 100);
        $(this).addClass('curr').siblings('a').removeClass('curr');
        if ($(document).height() == $('body').height() + $(window).scrollTop()) {
            $(this).addClass('curr').siblings('a').removeClass('curr');
        }
    });

    $("body").on("click", "span.nowCity", function() {
        var val = $(this).data('name');
        $(".chooseCity").show().html(val).css('color', 'red');
        $(".chooseCity").next().hide();
        $("body,html").animate({
            "scrollTop": $(".chooseCity").offset().top - $(".head-fixed").outerHeight() - 10
        }, 100);
    })

    $(window).scroll(function() {
        var scrollTop = $(document).scrollTop();
        var oItem = $(".choose-city-wrap").find('.box');
        var oName = '';
        $.each(oItem, function(i) {
            var oneItem = $(this);
            if (i == 0) {
                return;
            }
            var offsetTop = oneItem.offset().top;
            if (offsetTop - scrollTop < oneItem.prev().height()) {
                oName = oneItem.find('.city-list-title').attr("id");
                $(".choose-city-chart a.curr").removeClass("curr");
                $(".choose-city-chart").find("[data-key=" + oName + "]").addClass("curr");
            }
        })
    })

 
</script>

</html>